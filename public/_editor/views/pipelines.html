<div layout="row">

  <!-- AVAILABLE PIPELINES -->
  <div>
    <md-toolbar theme="indigo">
      <h2 class="md-toolbar-tools">
        <span>Available Pipelines</span>
        <span flex></span>
        <md-button ng-click="newPipe()" aria-label="new pipeline">New</md-button>
      </h2>
    </md-toolbar>
    <md-content>
      <md-list "overflow:scroll">
        <md-item ng-repeat="pipeline in pipelines">
          <md-item-content class="thin pipe_open_{{isPipeOpen(pipeline)}}" ng-click="openPipe(pipeline)">
            <div class="md-tile-content">
              <h3>{{pipeline.name}}</h3>
              <h4>version {{pipeline.version}}</h4>
              <p>{{pipeline.description | limitTo : 50}}</p>
            </div>
          </md-item-content>
          <md-divider ng-if="!$last"></md-divider>
        </md-item>
      </md-list>
    </md-content>
  </div>

  <!-- ACTIVE PIPELINE -->
  <div flex style="border-left: 1px solid grey;">
    <ng-switch on="hasActivePipeOpen()">
      <div class="animate-switch" ng-switch-when="false">
        <div ng-include="splash_page"></div>
      </div>
      <div class="animate-switch" ng-switch-when="true">
        <md-toolbar md-theme="indigo">
          <h2 class="md-toolbar-tools">
            <span>Pipeline '{{activePipe.name}}'</span>
            <span flex></span>
            <md-button ng-click="deletePipe()"aria-label="delete pipeline">delete</md-button>
            <md-button ng-click="savePipe()" aria-label="save pipeline">save</md-button>
            <md-button ng-click="closePipe()"aria-label="close pipeline">close</md-button>
          </h2>
        </md-toolbar>
        <div layout="row" layout-padding>
          <md-text-float class="wide" label="Pipeline Name" ng-model="activePipe.name"> </md-text-float>
          <md-text-float label="Version" ng-model="activePipe.version"> </md-text-float>
        </div>
        <div layout="row" layout-padding>
          <md-input-group tabindex="-1" ng-model="activePipe.description" label="Description" class="ng-isolate-scope md-default-theme md-input-has-value ng-valid" aria-invalid="false">
            <label for="p_desc" class="ng-binding">Description</label>
            <textarea rows="2" cols="60" id="p_desc" aria-disabled="false"
              class="ng-valid ng-touched">{{activePipe.description}}</textarea>
          </md-input-group>
        </div>

        <!-- PIPELINE ENGINES -->
        <div>
          <md-toolbar class="thin" md-theme="indigo">
            <h2 class="md-toolbar-tools">
              <span>Pipeline Elements</span>
              <span flex></span>
              <md-button ng-click="toggleAddEngine()" aria-label="add engine">add</md-button>
            </h2>
          </md-toolbar>
          <md-content>
            <md-list "overflow:scroll">
              <div ng-repeat="pipeEngine in activePipe.engines">
                <!-- add buttons-->
                <div ng-switch="toggledAddEngine()">
                  <div ng-switch-when="true">
                    <md-button class="md-raised md-primary" md-theme="yellow" ng-click="addEngine($index)" aria-label="add engine">Add Engine</md-button>
                    <md-button class="md-raised md-primary" md-theme="light-green" ng-click="addScript($index)" aria-label="add script">Add Script</md-button>
                  </div>
                </div>
                <div ng-switch="isRuta(pipeEngine)">
                  <!-- Ruta engine -->
                  <div ng-switch-when="true" class="script-border">
                    <md-input-group id="ruta_script" ng-click="openRutaEngine($index)">
                      <textarea rows="{{pipeEngine.script.length + 1}}" cols="80"
                        aria-disabled="false">{{pipeEngine.script | joinBy:'\n'}}</textarea>
                    </md-input-group>
                  </div>
                  <!-- uimaFIT engine -->
                  <div ng-switch-when="false" class="engine-border">
                    <div ng-click="openEngine(pipeEngine)">{{pipeEngine.id}}</div>
                  </div>
                </div>
                <md-divider md-theme="darkgrey" ng-if="!$last"></md-divider>
              </div>
              <!-- add buttons-->
              <div ng-switch="toggledAddEngine()">
                <div ng-switch-when="true">
                  <md-button class="md-raised md-primary" md-theme="yellow" ng-click="addEngine($index)" aria-label="add engine">Add Engine</md-button>
                  <md-button class="md-raised md-primary" md-theme="light-green" ng-click="addScript($index)" aria-label="add script">Add Script</md-button>
                </div>
              </div>
            </md-list>
          </md-content>
        </div>

        <!-- TESTS -->
        <div>
          <md-toolbar class="thin" md-theme="indigo">
            <h3 class="md-toolbar-tools">
              <span>Tests</span>
              <span flex></span>
              <md-button ng-click="runAllTests()">run all tests</md-button>
            </h3>
          </md-toolbar>
          <div ng-repeat="test in activePipe.tests">
            <!-- <md-subheader class="md-primary">Test {{$index + 1}}</md-subheader> -->
            <md-input-group class="test_area md-input-has-value">
              <label>Input</label>
              <textarea rows="1" id="test_in_{{$index}}"  ng-model="test.in"></textarea>
            </md-input-group>
            <div class="test_out">
              <label>Output</label>
              <div id="test_out_{{$index}}"></div>
            </div>
            <md-divider/>
          </div>
        </div>
      </div>
      <md-divider/>
    </ng-switch>
  </div>

  <!--RIGHT PANEL -->
  <div flex=10 style="padding-left:15px; border-left: 1px solid grey;">
    RIGHT
  </div>
</div>
